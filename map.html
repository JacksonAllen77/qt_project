<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>BDMAP</title>
    <style type="text/css">
        html {height: 100%}
        body {height: 100%; margin: 0px; padding: 0px;}
        #container {height: 100%;}
    </style>
    <script type="text/javascript" src="http://api.map.baidu.com/getscript?v=3.0&ak=您的密钥"></script>
    <script type="text/javascript" src="qwebchannel.js"></script>  <!-- 引入qwebchannel.js -->
</head>
<body>
    <div id="container"></div>

    <script type="text/javascript">
        // 创建地图实例
        var map = new BMap.Map("container");  
        map.centerAndZoom(new BMap.Point(100.939631, 33.078577), 5);  // 初始化地图，设置中心点坐标和地图级别
        map.enableScrollWheelZoom(); // 开启滚轮缩放
        map.disableDoubleClickZoom();
        map.addControl(new BMap.NavigationControl({ type: BMAP_NAVIGATION_CONTROL_LARGE, showZoomInfo: true }));
        map.addControl(new BMap.MapTypeControl({ mapTypes: [BMAP_NORMAL_MAP, BMAP_HYBRID_MAP], anchor: BMAP_ANCHOR_TOP_LEFT, offset: new BMap.Size(80, 50) }));
        map.addControl(new BMap.ScaleControl({ anchor: BMAP_ANCHOR_TOP_LEFT }));

        // 创建艇的标记和图标
        var boatMarker = new BMap.Marker();  // 艇的marker
        var boatIcon = new BMap.Symbol(BMap_Symbol_SHAPE_FORWARD_CLOSED_ARROW, {
            scale: 1.5,
            strokeWeight: 1,
            fillColor: "red",
            fillOpacity: 0.8
        });
        var boatLabel = new BMap.Label("0mD，0mH", { offset: new BMap.Size(20, -20) });
        boatLabel.setStyle({ color: "black", fontSize: "15px" });

        var boatPoints = [];  // 保存艇的轨迹点
        var boatTrackPolyline = new BMap.Polyline([], { strokeColor: "green", strokeWeight: 2, strokeOpacity: 0.5 });

        // 显示艇的位置
        function showBoatPosition(lng, lat, course) {
            var currentPosition = wgs84tobd09(lng, lat);  // 转换坐标
            var currentPoint = new BMap.Point(currentPosition[0], currentPosition[1]);
            boatIcon.setRotation(course);
            boatMarker.setIcon(boatIcon);
            boatMarker.setPosition(currentPoint);
            map.addOverlay(boatMarker);

            boatPoints.push(currentPoint);
            if (boatPoints.length == 1) {
                boatTrackPolyline.setPath(boatPoints);
                map.addOverlay(boatTrackPolyline);
            } else if (boatPoints.length > 1) {
                boatTrackPolyline.setPath(boatPoints);
            }
        }

        // 清除轨迹
        function clearTrack() {
            boatPoints = [];
            map.removeOverlay(boatTrackPolyline);
        }

        // 使用Qt WebChannel与Qt代码交互
        new QWebChannel(qt.webChannelTransport, function(channel) {
            window.bridge = channel.objects.passId;  // 注册一个通道，将window.bridge连接到qt下的passId，形成通路
            channel.objects.passId.boatPosUpdated.connect(showBoatPosition);
            channel.objects.passId.clearTrackClicked.connect(clearTrack);
        });
    </script>
</body>
</html>
helloworld